var w=Object.defineProperty,b=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;var y=(i,t,e)=>t in i?w(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,u=(i,t)=>{for(var e in t||(t={}))N.call(t,e)&&y(i,e,t[e]);if(P)for(var e of P(t))f.call(t,e)&&y(i,e,t[e]);return i},h=(i,t)=>b(i,L(t));import{C as r,h as D,t as g,w as m,o as k,g as C,a as l,b as R}from"./compositor.a727cf4d.js";const{trigger:p,state:d}=r,T=async(i={})=>{const{props:t={},size:e,meta:o={}}=i,c=d.collectionId,n=await r.Request.createProject({collectionId:c,props:t,meta:o,size:e}),s=await D(n.project),a=g(s);return d.projects=[...d.projects,s],p("ProjectAdded",{project:a}),a},U=async i=>{const{projectId:t,meta:e={}}=i,o=d.projects.find(n=>n.id===i.projectId);if(!o)return;const c=u(u({},o.props),e);return await r.clients.LiveApi().project.updateProject({collectionId:o.videoApi.project.collectionId,projectId:t,updateMask:["metadata"],metadata:c}),o.props=c,p("ProjectMetaUpdated",{projectId:t,meta:o.props}),c},x=async i=>{const t=d.projects.find(c=>c.id===i.projectId);if(!t){d.activeProjectId=null,p("ActiveProjectChanged",null);return}const e=d.projects.find(c=>c.id===d.activeProjectId);if(t===e)return;e&&(Array.from(m.rooms.keys()).map(m.removeRoom),await r.clients.LayoutApi().unsubscribeFromLayout(e.layoutApi.layoutId),await r.clients.LiveApi().unsubscribeFromProject(e.videoApi.project.collectionId,e.videoApi.project.projectId)),await r.clients.LayoutApi().subscribeToLayout(t.layoutApi.layoutId),await r.clients.LiveApi().subscribeToProject(t.videoApi.project.collectionId,t.videoApi.project.projectId);let o=await r.clients.LiveApi().project.getProject({collectionId:t.videoApi.project.collectionId,projectId:t.videoApi.project.projectId,status:!0});return t.videoApi.phase=o.status.phase,d.activeProjectId=t.id,p("ActiveProjectChanged",{projectId:t.id}),g(t)},K=async i=>{const{projectId:t,displayName:e="Guest"}=i,o=d.projects.find(A=>A.id===t);let c=o.sfuToken;if(!c){let{webrtcAccess:A}=await r.clients.LiveApi().authentication.createWebRtcAccessToken({collectionId:o.videoApi.project.collectionId,projectId:o.videoApi.project.projectId,displayName:e});c=A.accessToken}const s=k(c).video.room,a=new URL(r.clients.getLiveKitServer()),j=a.host+a.pathname,I=m.ensureRoom(j,s,c);I.bindApiClient(r.clients),await I.connect({logLevel:r.logLevel}),o.sfuToken=c,o.roomId=s;const v=C(s);return p("RoomJoined",{projectId:o.id,room:v}),v},E=async i=>{let{props:t={},parentId:e,index:o,projectId:c=d.activeProjectId}=i;const n=l(c);t=h(u({},t),{layoutId:n.layoutApi.layoutId,type:"child"});const s=await n.compositor.insert(t,e,o);return p("NodeAdded",{projectId:c,nodeId:s}),p("NodeChanged",{projectId:c,nodeId:e}),n.compositor.get(s)},F=async i=>{var n;let{nodeId:t,projectId:e=d.activeProjectId}=i;const o=l(e),c=(n=o.compositor.getParent(t))==null?void 0:n.id;o.compositor.remove(t),p("NodeRemoved",{projectId:e,nodeId:t}),p("NodeChanged",{projectId:e,nodeId:c})},S=async i=>{let{nodeId:t,props:e={},projectId:o=d.activeProjectId}=i;const c=l(o);return delete e.type,delete e.sourceType,c.compositor.update(t,e),p("NodeChanged",{projectId:o,nodeId:t}),c.compositor.get(t)},q=async i=>{let{nodeId:t,layout:e,projectId:o=d.activeProjectId,layoutProps:c={}}=i;l(o).compositor.update(t,{layout:e,layoutProps:c}),p("NodeChanged",{projectId:o,nodeId:t})},z=async i=>{const{nodeId:t,parentId:e,projectId:o=d.activeProjectId,index:c}=i;l(o).compositor.move(t,e,c),p("NodeChanged",{projectId:o,nodeId:t})},G=async i=>{var a,j;const{nodeAId:t,nodeBId:e,projectId:o=d.activeProjectId}=i,c=l(o),n=(a=c.compositor.getParent(t))==null?void 0:a.id,s=(j=c.compositor.getParent(e))==null?void 0:j.id;c.compositor.swap(t,e),p("NodeChanged",{projectId:o,nodeId:n}),p("NodeChanged",{projectId:o,nodeId:s})},J=async i=>{const{parentId:t,childIds:e,projectId:o=d.activeProjectId}=i;l(o).compositor.reorder(t,e),p("NodeChanged",{projectId:o,nodeId:t})},W=async i=>{const{projectId:t=d.activeProjectId}=i,e=l(t);await r.clients.LiveApi().project.startProjectBroadcast({collectionId:e.videoApi.project.collectionId,projectId:e.videoApi.project.projectId})},H=async i=>{const{projectId:t=d.activeProjectId}=i,e=l(t);await r.clients.LiveApi().project.stopProjectBroadcast({collectionId:e.videoApi.project.collectionId,projectId:e.videoApi.project.projectId})},O=async i=>{var v;const{rtmpUrl:t,rtmpKey:e,enabled:o,projectId:c=d.activeProjectId,metadata:n}=i,s=l(c),a={rtmpPush:{key:e,url:t}},j=await((v=r.clients.LiveApi().destination)==null?void 0:v.createDestination({collectionId:s.videoApi.project.collectionId,projectId:s.videoApi.project.projectId,address:a,enabled:o,metadata:n}));return s.videoApi.project.destinations.push(j.destination),R(j.destination)},Q=async i=>{var c;const{destinationId:t,projectId:e=d.activeProjectId}=i,o=l(e);await((c=r.clients.LiveApi().destination)==null?void 0:c.deleteDestination({collectionId:o.videoApi.project.collectionId,projectId:o.videoApi.project.projectId,destinationId:t})),o.videoApi.project.destinations=o.videoApi.project.destinations.filter(n=>n.destinationId!==t)},V=async i=>{var j;const{rtmpUrl:t,rtmpKey:e,destinationId:o,projectId:c=d.activeProjectId}=i,n=l(c),s={key:e,url:t};await((j=r.clients.LiveApi().destination)==null?void 0:j.updateDestination({collectionId:n.videoApi.project.collectionId,projectId:n.videoApi.project.projectId,destinationId:o,updateMask:["address.rtmpPush"],address:{rtmpPush:s}}));const a=n.videoApi.project.destinations.find(I=>o===I.destinationId);a.address.rtmpPush=s},X=async i=>{var a;const{enabled:t,destinationId:e,projectId:o=d.activeProjectId}=i,c=l(o),n=c.videoApi.project.destinations.find(j=>e===j.destinationId);if(n.enabled===t)return;await((a=r.clients.LiveApi().destination)==null?void 0:a.updateDestination({collectionId:c.videoApi.project.collectionId,projectId:c.videoApi.project.projectId,destinationId:e,updateMask:["enabled"],enabled:t})),n.enabled=t,p(t?"DestinationEnabled":"DestinationDisabled",{projectId:o,destinationId:e})},Y=async i=>{var a,j;const{rtmpUrl:t,rtmpKey:e,projectId:o=d.activeProjectId}=i,c=l(o),n={key:e,url:t},s=!0;if(c.videoApi.project.destinations.length>0){await((a=r.clients.LiveApi().destination)==null?void 0:a.updateDestination({collectionId:c.videoApi.project.collectionId,projectId:c.videoApi.project.projectId,destinationId:c.videoApi.project.destinations[0].destinationId,updateMask:["address.rtmpPush"],address:{rtmpPush:n}}));const I=c.videoApi.project.destinations[0];I.address.rtmpPush=n}else{const I=await((j=r.clients.LiveApi().destination)==null?void 0:j.createDestination({collectionId:c.videoApi.project.collectionId,projectId:c.videoApi.project.projectId,address:{rtmpPush:n},enabled:s}));c.videoApi.project.destinations.push(I.destination)}p("DestinationSet",{projectId:o,rtmpUrl:t,rtmpKey:e})};export{O as addDestination,E as createNode,T as createProject,F as deleteNode,K as joinRoom,z as moveNode,Q as removeDestination,J as reorderNodes,x as setActiveProject,Y as setDestination,X as setDestinationEnabled,q as setNodeLayout,W as startBroadcast,H as stopBroadcast,G as swapNodes,V as updateDestination,S as updateNode,U as updateProjectMeta};
//# sourceMappingURL=commands.dd6ee383.js.map
