var g=Object.defineProperty,w=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;var y=(i,t,e)=>t in i?g(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,u=(i,t)=>{for(var e in t||(t={}))L.call(t,e)&&y(i,e,t[e]);if(P)for(var e of P(t))f.call(t,e)&&y(i,e,t[e]);return i},h=(i,t)=>w(i,D(t));import{C as p,h as N,t as b,w as m,o as C,g as k,a as l,b as R}from"./compositor.4f5ee56e.js";const{trigger:r,state:a}=p,T=async(i={})=>{const{props:t={},size:e,meta:c={}}=i,o=a.collectionId,n=await p.Request.createProject({collectionId:o,props:t,meta:c,size:e}),d=await N(n.project),s=b(d);return a.projects=[...a.projects,d],r("ProjectAdded",{project:s}),s},U=async i=>{const{projectId:t,meta:e={}}=i,c=a.projects.find(n=>n.id===i.projectId);if(!c)return;const o=u(u({},c.props),e);return await p.clients.LiveApi().project.updateProject({collectionId:c.videoApi.project.collectionId,projectId:t,updateMask:["metadata"],metadata:o}),c.props=o,r("ProjectMetaUpdated",{projectId:t,meta:c.props}),o},x=async i=>{const t=a.projects.find(o=>o.id===i.projectId);if(!t){a.activeProjectId=null,r("ActiveProjectChanged",null);return}const e=a.projects.find(o=>o.id===a.activeProjectId);if(t===e)return;e&&(Array.from(m.rooms.keys()).map(m.removeRoom),await p.clients.LayoutApi().unsubscribeFromLayout(e.layoutApi.layoutId),await p.clients.LiveApi().unsubscribeFromProject(e.videoApi.project.collectionId,e.videoApi.project.projectId)),await p.clients.LayoutApi().subscribeToLayout(t.layoutApi.layoutId),await p.clients.LiveApi().subscribeToProject(t.videoApi.project.collectionId,t.videoApi.project.projectId);let c=await p.clients.LiveApi().project.getProject({collectionId:t.videoApi.project.collectionId,projectId:t.videoApi.project.projectId,status:!0});return t.videoApi.phase=c.status.phase,a.activeProjectId=t.id,r("ActiveProjectChanged",{projectId:t.id}),b(t)},K=async i=>{const{projectId:t,displayName:e="Guest"}=i,c=a.projects.find(A=>A.id===t);let o=c.sfuToken;if(!o){let{webrtcAccess:A}=await p.clients.LiveApi().authentication.createWebRtcAccessToken({collectionId:c.videoApi.project.collectionId,projectId:c.videoApi.project.projectId,displayName:e});o=A.accessToken}const d=C(o).video.room,s=new URL(p.clients.getLiveKitServer()),j=s.host+s.pathname,I=m.ensureRoom(j,d,o);I.bindApiClient(p.clients),await I.connect(),c.sfuToken=o,c.roomId=d;const v=k(d);return r("RoomJoined",{projectId:c.id,room:v}),v},E=async i=>{let{props:t={},parentId:e,index:c,projectId:o=a.activeProjectId}=i;const n=l(o);t=h(u({},t),{layoutId:n.layoutApi.layoutId,type:"child"});const d=await n.compositor.insert(t,e,c);return r("NodeAdded",{projectId:o,nodeId:d}),r("NodeChanged",{projectId:o,nodeId:e}),n.compositor.get(d)},F=async i=>{var n;let{nodeId:t,projectId:e=a.activeProjectId}=i;const c=l(e),o=(n=c.compositor.getParent(t))==null?void 0:n.id;c.compositor.remove(t),r("NodeRemoved",{projectId:e,nodeId:t}),r("NodeChanged",{projectId:e,nodeId:o})},S=async i=>{let{nodeId:t,props:e={},projectId:c=a.activeProjectId}=i;const o=l(c);return delete e.type,delete e.sourceType,o.compositor.update(t,e),r("NodeChanged",{projectId:c,nodeId:t}),o.compositor.get(t)},q=async i=>{let{nodeId:t,layout:e,projectId:c=a.activeProjectId,layoutProps:o={}}=i;l(c).compositor.update(t,{layout:e,layoutProps:o}),r("NodeChanged",{projectId:c,nodeId:t})},z=async i=>{const{nodeId:t,parentId:e,projectId:c=a.activeProjectId,index:o}=i;l(c).compositor.move(t,e,o),r("NodeChanged",{projectId:c,nodeId:t})},G=async i=>{var s,j;const{nodeAId:t,nodeBId:e,projectId:c=a.activeProjectId}=i,o=l(c),n=(s=o.compositor.getParent(t))==null?void 0:s.id,d=(j=o.compositor.getParent(e))==null?void 0:j.id;o.compositor.swap(t,e),r("NodeChanged",{projectId:c,nodeId:n}),r("NodeChanged",{projectId:c,nodeId:d})},J=async i=>{const{parentId:t,childIds:e,projectId:c=a.activeProjectId}=i;l(c).compositor.reorder(t,e),r("NodeChanged",{projectId:c,nodeId:t})},W=async i=>{const{projectId:t=a.activeProjectId}=i,e=l(t);await p.clients.LiveApi().project.startProjectBroadcast({collectionId:e.videoApi.project.collectionId,projectId:e.videoApi.project.projectId})},H=async i=>{const{projectId:t=a.activeProjectId}=i,e=l(t);await p.clients.LiveApi().project.stopProjectBroadcast({collectionId:e.videoApi.project.collectionId,projectId:e.videoApi.project.projectId})},O=async i=>{var v;const{rtmpUrl:t,rtmpKey:e,enabled:c,projectId:o=a.activeProjectId,metadata:n}=i,d=l(o),s={rtmpPush:{key:e,url:t}},j=await((v=p.clients.LiveApi().destination)==null?void 0:v.createDestination({collectionId:d.videoApi.project.collectionId,projectId:d.videoApi.project.projectId,address:s,enabled:c,metadata:n}));d.videoApi.project.destinations.push(j.destination);const I=R(j.destination);return r("DestinationAdded",{projectId:o,destination:I}),I},Q=async i=>{var o;const{destinationId:t,projectId:e=a.activeProjectId}=i,c=l(e);await((o=p.clients.LiveApi().destination)==null?void 0:o.deleteDestination({collectionId:c.videoApi.project.collectionId,projectId:c.videoApi.project.projectId,destinationId:t})),c.videoApi.project.destinations=c.videoApi.project.destinations.filter(n=>n.destinationId!==t),r("DestinationRemoved",{projectId:e,destinationId:t})},V=async i=>{var j;const{rtmpUrl:t,rtmpKey:e,destinationId:c,projectId:o=a.activeProjectId}=i,n=l(o),d={key:e,url:t};await((j=p.clients.LiveApi().destination)==null?void 0:j.updateDestination({collectionId:n.videoApi.project.collectionId,projectId:n.videoApi.project.projectId,destinationId:c,updateMask:["address.rtmpPush"],address:{rtmpPush:d}}));const s=n.videoApi.project.destinations.find(I=>c===I.destinationId);s.address.rtmpPush=d,r("DestinationChanged",{projectId:o,destination:{id:s.destinationId,enabled:s.enabled,address:s.address,props:s.metadata}})},X=async i=>{var d;const{projectId:t,destinationId:e,metadata:c}=i,o=l(t);await((d=p.clients.LiveApi().destination)==null?void 0:d.updateDestination({collectionId:o.videoApi.project.collectionId,projectId:o.videoApi.project.projectId,destinationId:e,updateMask:["metadata"],metadata:c}));const n=o.videoApi.project.destinations.find(s=>e===s.destinationId);n.metadata=c,r("DestinationChanged",{projectId:t,destination:{id:n.destinationId,enabled:n.enabled,address:n.address,props:n.metadata}})},Y=async i=>{var s;const{enabled:t,destinationId:e,projectId:c=a.activeProjectId}=i,o=l(c),n=o.videoApi.project.destinations.find(j=>e===j.destinationId);if(n.enabled===t)return;await((s=p.clients.LiveApi().destination)==null?void 0:s.updateDestination({collectionId:o.videoApi.project.collectionId,projectId:o.videoApi.project.projectId,destinationId:e,updateMask:["enabled"],enabled:t})),n.enabled=t,r(t?"DestinationEnabled":"DestinationDisabled",{projectId:c,destinationId:e})},Z=async i=>{var s,j;const{rtmpUrl:t,rtmpKey:e,projectId:c=a.activeProjectId}=i,o=l(c),n={key:e,url:t},d=!0;if(o.videoApi.project.destinations.length>0){await((s=p.clients.LiveApi().destination)==null?void 0:s.updateDestination({collectionId:o.videoApi.project.collectionId,projectId:o.videoApi.project.projectId,destinationId:o.videoApi.project.destinations[0].destinationId,updateMask:["address.rtmpPush"],address:{rtmpPush:n}}));const I=o.videoApi.project.destinations[0];I.address.rtmpPush=n}else{const I=await((j=p.clients.LiveApi().destination)==null?void 0:j.createDestination({collectionId:o.videoApi.project.collectionId,projectId:o.videoApi.project.projectId,address:{rtmpPush:n},enabled:d}));o.videoApi.project.destinations.push(I.destination)}r("DestinationSet",{projectId:c,rtmpUrl:t,rtmpKey:e})};export{O as addDestination,E as createNode,T as createProject,F as deleteNode,K as joinRoom,z as moveNode,Q as removeDestination,J as reorderNodes,x as setActiveProject,Z as setDestination,Y as setDestinationEnabled,q as setNodeLayout,W as startBroadcast,H as stopBroadcast,G as swapNodes,V as updateDestination,X as updateDestinationMeta,S as updateNode,U as updateProjectMeta};
//# sourceMappingURL=commands.fd39c575.js.map
